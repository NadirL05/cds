datasource db {
  provider = "postgresql"
}

generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

model User {
  id                   String               @id @default(uuid())
  email                String               @unique
  role                 Role                 @default(MEMBER)
  homeStudioId         String?
  createdAt            DateTime             @default(now())
  password             String?
  stripeCustomerId     String?
  subscriptionStatus   String?
  plan                 String?
  accounts             Account[]
  bookings             Booking[]
  profile              Profile?
  sessions             Session[]
  homeStudio           Studio?              @relation(fields: [homeStudioId], references: [id])
  coachingPreferences  CoachingPreferences?
  subscription         Subscription?
}

model Profile {
  id           String    @id @default(uuid())
  userId       String    @unique
  firstName    String
  lastName     String
  goals        String[]
  medicalNotes String?
  level        String?
  height       Float?
  weight       Float?
  gender       String?
  birthDate    DateTime?
  age          Int?
  city         String?
  department   String?
  phoneNumber  String?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Studio {
  id                 String    @id @default(uuid())
  name               String
  city               String
  maxCapacityPerSlot Int       @default(6)
  createdAt          DateTime  @default(now())
  bookings           Booking[]
  members            User[]
}

model Booking {
  id           String   @id @default(uuid())
  studioId     String
  userId       String
  startTime    DateTime
  endTime      DateTime
  status       String   @default("CONFIRMED")
  programUsed  String?
  intensityLog Json?
  studio       Studio   @relation(fields: [studioId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum Role {
  SUPER_ADMIN
  FRANCHISE_OWNER
  COACH
  MEMBER
}

// AI Coaching Enums
enum Goal {
  RAFFERMIR
  PRISE_MASSE
  PERTE_POIDS
  SE_MUSCLER
}

enum Level {
  DEBUTANT
  INTERMEDIAIRE
  CONFIRME
}

enum Frequency {
  UNE_DEUX
  TROIS_QUATRE
  CINQ_PLUS
}

// AI Coaching Preferences (One-to-One with User)
model CoachingPreferences {
  id                  String    @id @default(uuid())
  userId              String    @unique
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Sport Fields
  goal                Goal?
  level               Level?
  frequency           Frequency?
  
  // Diet Fields (Booleans)
  eatsMeat            Boolean?
  eatsFish            Boolean?
  eatsEggs            Boolean?
  
  // Diet Fields (Arrays)
  veggies             String[]  // List of preferred vegetables
  starches            String[]  // List of preferred f√©culents
  drinks              String[]  // List of preferred drinks
  
  // Free Text
  dietaryRestrictions String?   // Allergies or specific notes
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

// Subscription tracking (One-to-One with User)
model Subscription {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Stripe fields
  stripeSubscriptionId String?  @unique
  stripePriceId        String?
  status               String?  // "active", "trialing", "past_due", "canceled"
  
  // Trial tracking
  trialEndsAt          DateTime?
  
  // Billing cycle
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
}
